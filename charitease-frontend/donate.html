<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CharitEase - Donate</title>
  <link rel="stylesheet" href="donate.css">
</head>
<body>
  <header>
    <nav>
      <div class="logo">
        <h1>CharitEase</h1>
      </div>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="donate.html">Donate</a>
        <a href="login.html" class="btn-primary">Login</a>
      </div>
    </nav>
  </header>

  <section class="donation-container">
    <div class="donation-options">
      <h2>Select Donation Type</h2>
      <select id="categorySelect">
        <option value="">All Categories</option>
        <option value="1">Clothes</option>
        <option value="2">Books</option>
        <option value="3">Toys</option>
        <option value="4">Food</option>
        <option value="5">Blood</option>
      </select>
    </div>

    <div class="organization-list">
      <h2>Available Organizations</h2>
      <div id="organizationsContainer"></div>
    </div>
  </section>

  <section class="donation-schedule">
    <div class="address-container">
      <h2>Enter Your Address for Pickup</h2>
      <input type="text" placeholder="Enter your address" id="address">
    </div>
    
    <div class="schedule-container">
      <h2>Schedule Your Donation</h2>
      <input type="date" id="pickup-date">
      <select id="time-slot">
        <option value="8:00 AM">8:00 AM</option>
        <option value="9:00 AM">9:00 AM</option>
        <option value="10:00 AM">10:00 AM</option>
        <option value="11:00 AM">11:00 AM</option>
        <option value="12:00 PM">12:00 PM</option>
        <option value="1:00 PM">1:00 PM</option>
        <option value="2:00 PM">2:00 PM</option>
        <option value="3:00 PM">3:00 PM</option>
        <option value="4:00 PM">4:00 PM</option>
        <option value="5:00 PM">5:00 PM</option>
        <option value="6:00 PM">6:00 PM</option>
        <option value="7:00 PM">7:00 PM</option>
        <option value="8:00 PM">8:00 PM</option>
      </select>
      <button class="btn-confirm">Confirm & Submit Donation</button>
    </div>
  </section>

  <script>
  let allOrganizations = []; // Store all organizations

  // Load all organizations initially
  async function loadOrganizations() {
    try {
      const response = await fetch('http://localhost:5000/api/organizations');
      allOrganizations = await response.json();
      console.log('Fetched organizations:', allOrganizations); // Debug log
      displayOrganizations(allOrganizations);
    } catch (err) {
      console.error('Error:', err);
    }
  }

  // Display organizations in the container
  function displayOrganizations(organizations) {
    const container = document.getElementById('organizationsContainer');
    if (organizations.length === 0) {
      container.innerHTML = '<p>No organizations found for this category.</p>';
      return;
    }

    container.innerHTML = organizations.map(org => {
      return `
        <div class="organization-card">
          <h3>${org.name}</h3>
          <p>${org.description || ''}</p>
          <p>Categories: ${Array.isArray(org.categories) && org.categories.length > 0 
            ? org.categories.join(', ') 
            : 'None specified'}</p>
          <button onclick="selectOrganization(${org.org_id})">Select</button>
        </div>
      `;
    }).join('');
  }

  // Filter organizations by category
  function filterOrganizations(categoryId) {
    if (!categoryId) {
      displayOrganizations(allOrganizations);
      return;
    }

    const filteredOrgs = allOrganizations.filter(org => {
      // Convert category names to IDs for comparison
      const categoryMap = {
        '1': 'clothes',
        '2': 'books',
        '3': 'toys',
        '4': 'food',
        '5': 'blood'
      };
      return org.categories.includes(categoryMap[categoryId]);
    });
    
    displayOrganizations(filteredOrgs);
  }

  // Helper function to convert category ID to name
  function getCategoryName(categoryId) {
    const categories = {
      1: 'Clothes',
      2: 'Books',
      3: 'Toys',
      4: 'Food',
      5: 'Blood'
    };
    return categories[categoryId] || 'Unknown';
  }

  // Handle category selection
  document.getElementById('categorySelect').addEventListener('change', (e) => {
    const categoryId = e.target.value;
    filterOrganizations(categoryId);
  });

  // Load organizations when page loads
  document.addEventListener('DOMContentLoaded', loadOrganizations);

  // Function to handle organization selection
  function selectOrganization(orgId) {
    // Your existing selection logic
    console.log('Selected organization:', orgId);
    // Redirect or show donation form
  }
  </script>
</body>
</html>
